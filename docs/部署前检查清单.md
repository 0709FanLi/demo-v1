# 📋 部署前检查清单

## ✅ 部署前准备工作

### 1. 服务器信息确认

**当前配置**（在 `deploy.sh` 中）：
- **服务器 IP**: 106.14.204.36
- **用户名**: root
- **密码**: Yuan0730zhen. （脚本中已配置）
- **SSH 端口**: 22
- **远程目录**: /root/anti-aging-system

**需要确认**：
- ✅ 服务器是否可以 SSH 连接？
- ✅ 密码是否正确？
- ✅ 服务器是否有足够的资源（4GB+ 内存，20GB+ 磁盘）？

### 2. 环境变量配置

**需要在服务器上配置的环境变量**：

**已更新到 `env.production.template`**：
- ✅ `DASHSCOPE_API_KEY` - 阿里云 API Key（已有）
- ✅ `EMBEDDING_MODEL` - 已更新为 `BAAI/bge-large-zh-v1.5`
- ✅ 其他配置项

**⚠️ 重要**：部署脚本会自动从 `env.production.template` 创建 `.env` 文件，但需要确认：
- API Key 是否正确？
- 是否需要更新其他配置？

### 3. 代码更新确认

**本次部署包含的新功能**：
- ✅ 文件上传导入功能（JSON/CSV/Excel/TXT/Markdown/PDF）
- ✅ 知识库 CRUD 功能完善
- ✅ 美观的弹框和消息提示
- ✅ 重构的智能对话页面
- ✅ BGE 向量模型支持

**新增依赖**：
- ✅ `pandas==2.1.4`
- ✅ `openpyxl==3.1.2`
- ✅ `PyPDF2==3.0.1`

### 4. Docker 配置检查

**Dockerfile 状态**：
- ✅ 后端 Dockerfile 存在
- ✅ 前端 Dockerfile 存在
- ✅ docker-compose.prod.yml 配置完整

### 5. 部署方式选择

**方式一：一键部署脚本（推荐）**
```bash
bash deploy.sh
```
- 需要交互确认
- 自动完成所有步骤

**方式二：全自动部署脚本**
```bash
bash deploy_auto.sh
```
- 无需交互
- 自动完成所有步骤

## 🚀 部署步骤

### 步骤 1：确认部署信息

在执行部署前，请确认：

1. **服务器连接信息**：
   - IP: 106.14.204.36
   - 用户: root
   - 密码: Yuan0730zhen.
   - 是否确认正确？

2. **API Key 配置**：
   - 当前 `env.production.template` 中的 API Key 是否正确？
   - 是否需要更新？

3. **数据备份**（如果是更新部署）：
   - 是否需要备份现有数据？
   - 知识库数据是否需要保留？

### 步骤 2：执行部署

选择一种方式执行部署：

```bash
# 方式一：交互式部署
bash deploy.sh

# 方式二：全自动部署
bash deploy_auto.sh
```

### 步骤 3：验证部署

部署完成后，访问：
- 前端：http://106.14.204.36
- API 文档：http://106.14.204.36/api/docs
- 健康检查：http://106.14.204.36/api/health

## ⚠️ 注意事项

1. **首次部署**：
   - 需要下载向量模型（BGE-large-zh-v1.5），约 1.3GB
   - 需要下载 Docker 镜像
   - 预计耗时：15-30 分钟

2. **更新部署**：
   - 会停止旧容器，启动新容器
   - 知识库数据会保留（在 volumes 中）
   - 建议先备份数据

3. **依赖安装**：
   - 后端需要安装 pandas、openpyxl、PyPDF2
   - 这些依赖已添加到 requirements.txt

4. **环境变量**：
   - 部署脚本会自动从 `env.production.template` 创建 `.env`
   - 如果服务器上已有 `.env`，不会覆盖（需要手动更新）

## 🔧 如果需要我协助

请告诉我：
1. ✅ 服务器信息是否正确？
2. ✅ API Key 是否需要更新？
3. ✅ 是否需要备份现有数据？
4. ✅ 选择哪种部署方式（交互式/全自动）？

准备好后，我会执行部署！

